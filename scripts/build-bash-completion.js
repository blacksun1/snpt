import fs from 'fs';
import path from 'path';

import copyCommand from '../src/command/copy.js';
import listCommand from '../src/command/list.js';
import setAccessTokenCommand from '../src/command/set-access-token.js';
import syncCommand from '../src/command/sync.js';
import writeToDiskCommand from '../src/command/write-to-disk.js';

const commands = [
  copyCommand,
  listCommand,
  setAccessTokenCommand,
  syncCommand,
  writeToDiskCommand,
];

const commandNamesStr = Array.reduce(commands, (str, command) => {
  return str += ` ${command.getName()}`;
}, '');

const fileContents = `# This file is automatically generated - Do not modify directly
_snpt()
{
    local cur=\${COMP_WORDS[COMP_CWORD]}
    COMPREPLY=( $(compgen -W "${commandNamesStr.trim()}" -- $cur) )
}
complete -F _snpt snpt`;

const filePath = path.resolve('./bash_completion');

fs.writeFile(filePath, fileContents, err => {
  if (err) {
    return console.error(`Failed to create ${filePath}`)
  }

  console.info(`Successfully created bash_completion at ${filePath}`);
});
